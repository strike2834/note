# Vim

## 基礎操作

- `vim 檔案名稱`：使用 vim 開啟檔案
- 開啟檔案之後，Vim 預設為「觀看模式」，只能瀏覽文件內容
- 按下 `i` 鍵後，左下角會出現 `--INSERT--`，代表進入「編輯模式」，才能修改文件
- 關於「模式」功能詳細可參照下表

| 按鍵                | 功能                                     |
| ------------------- | ---------------------------------------- |
| `v`                 | 觀看模式                                 |
| `i`                 | 於錨點處 前方 進入編輯模式               |
| `I`                 | 於錨點行 第一個非空白字元處 進入編輯模式 |
| `a`                 | 於錨點處 後方 進入編輯模式               |
| `A`                 | 於錨點行 最後一個字元處 進入編輯模式     |
| `o`                 | 於錨點處 下方新增一行後 進入編輯模式     |
| `O`                 | 於錨點處 上方新增一行後 進入編輯模式     |
| `cc`                | 刪除錨點所在行內容後 進入編輯模式        |
| `r`                 | 進入僅更換一個字元的編輯模式（替換模式） |
| `ESC`／`Ctrl` + `[` | 取消指令或退出編輯模式                   |
| `:`                 | 命令行模式                               |

修改完文件內容後，需要先按下 `ESC` 鍵回到觀看模式，再按下 `:` 鍵，
左下角有同樣出現冒號時，就成功進入 Vim 的「命令行模式」，
再輸入 `w`（顯示為 `:w`）後按下 `Enter` 便可存檔，
同樣操作輸入 `:q` 可以離開編輯器，更詳細的命令行模式功能可以參照下表。

## 命令行模式

### 檔案功能

| 按鍵             | 功能                                       |
| ---------------- | ------------------------------------------ |
| `:w`             | 存檔                                       |
| `:!w`            | 強制存檔                                   |
| `:w [檔案名稱]`  | 另存新檔                                   |
| `:q`             | 退出 vi                                    |
| `:!q`            | 不存檔退出                                 |
| `:wq`            | 存檔並退出 vi                              |
| `:x`             | 存檔並退出 vi                              |
| `:w !sudo tee %` | 以 root 的權限存檔                         |
| `:e [檔案名稱]`  | 編輯其它檔案                               |
| `:e!`            | 還原至檔案編輯前的狀態                     |
| `:r [檔案名稱]`  | 讀取另一個檔案的內容，並添加到錨點行的後面 |
| `:n`             | 切換到下一個開啟的檔案                     |
| `:N`             | 切換到上一個開啟的檔案                     |
| `:set nu`        | 顯示行號                                   |
| `:set nonu`      | 取消行號顯示                               |
| `:files`         | 列出所有開啟的檔案                         |
| `:Ex`            | 開啟檔案瀏覽器                             |
| `:Ex [路徑]`     | 於指定路徑開啟檔案瀏覽器                   |
| `:Hex`           | 分割水平視窗後，再開啟檔案瀏覽器           |
| `:Vex`           | 分割垂直視窗後，再開啟檔案瀏覽器           |
| `:Tex`           | 新增頁籤後，再開啟檔案瀏覽器               |
| `:Hex [路徑]`    | 分割水平視窗後，再於指定路徑開啟檔案瀏覽器 |
| `:Vex [路徑]`    | 分割垂直視窗後，再於指定路徑開啟檔案瀏覽器 |
| `:Tex [路徑]`    | 新增頁籤後，再於指定路徑開啟檔案瀏覽器     |

### 視窗分割

| 按鍵                 | 功能                                           |
| -------------------- | ---------------------------------------------- |
| `:new`               | 新增水平分割視窗                               |
| `:new 檔案名稱`      | 新增水平分割視窗，並在新增的視窗載入檔案       |
| `:vnew`              | 新增垂直分割視窗                               |
| `:vnew 檔案名稱`     | 新增垂直分割視窗，並在新增的視窗載入檔案       |
| `:sp`                | 新增水平分割視窗，並在新增的視窗載入目前的檔案 |
| `:sp 檔案名稱`       | 新增水平分割視窗，並在新增的視窗載入檔案       |
| `:vsp`               | 新增垂直分割視窗，並在新增的視窗載入目前的檔案 |
| `:vsp 檔案名稱`      | 新增垂直分割視窗，並在新增的視窗載入檔案       |
| `Ctrl + W -> 方向鍵` | 切換視窗                                       |
| `:only`              | 僅保留目前的視窗                               |

### 頁籤

| 按鍵             | 功能                                |
| ---------------- | ----------------------------------- |
| `:tabe`          | 新增頁籤                            |
| `:tabe 檔案名稱` | 新增頁籤，並在新頁籤載入指定檔案    |
| `:tabc`          | 關閉目前頁籤，等同 `:q`             |
| `:tabo`          | 關閉所有頁籤                        |
| `:tabn`          | 移至下一個頁籤                      |
| `:tabp`          | 移至上一個頁籤                      |
| `gt`             | 移至下一個頁籤                      |
| `gT`             | 移至上一個頁籤                      |
| `:tabfirst`      | 移至第一個頁籤                      |
| `:tablast`       | 移至最後一個頁籤                    |
| `:tabm 頁籤編號` | 移至特定編號的頁籤（編號從 0 開始） |
| `:tabs`          | 列出所有頁籤                        |

Vim 也可以使用 `h`、`j`、`k`、`l` 四個鍵替代左、下、上、右鍵，
在前方先輸入數字（例：`11h`）可以做出指定次數的移動，
詳細的錨點移動相關操作可以參照下表。

## 移動錨點

| 按鍵             | 功能                              | 記法           |
| ---------------- | --------------------------------- | -------------- |
| `h`              | 左                                |                |
| `j`              | 下                                |                |
| `k`              | 上                                |                |
| `l`              | 右                                |                |
| `gg`             | 移到第一行                        | goto           |
| `G`              | 移到最後一行                      | Goto           |
| `^`／`0`         | 移動到該行行首                    | 正規表達式 `^` |
| `$`              | 移動到該行行尾                    | 正規表達式 `$` |
| `[數字] + G`     | 移動到第 `[數字]` 行              | Goto           |
| `[數字] + Space` | 向右移動 `[數字]` 個字元          |                |
| `[數字] + Enter` | 向下移動 `[數字]` 行              |                |
| `ctrl+d`         | 往下移動半頁                      |                |
| `ctrl+f`         | 往下移動一頁                      |                |
| `ctrl+u`         | 往上移動半頁                      |                |
| `ctrl+b`         | 往上移動一頁                      |                |
| `H`              | 移動至畫面最上端                  | high           |
| `M`              | 移動至畫面中央處                  | middle         |
| `L`              | 移動至畫面最下方                  | low            |
| `w`              | 移至下個字串 首個字元             | word           |
| `W`              | 移至下個字串 首個字元（包含符號） | word           |
| `e`              | 移至下個字串 最後一個字元         |                |
| `b`              | 移至上個字串 首個字元             | backward       |
| `B`              | 移至上個字串 首個字元（包含符號） | backward       |
| `f[char]`        | 移動至行內右側指定文字            | find           |
| `F[char]`        | 移動至行內左側指定文字            | find           |
| `t[char]`        | 移動至行內右側指定文字前方        | till           |
| `T[char]`        | 移動至行內左側指定文字前方        | till           |
| `+`              | 移動至下個非空白字元前方          |                |

vim 的精髓在於組合鍵的運用，例如想移到下個字串的最後一個字元，並進入編輯模式，就可使用 `ga`
或是想往後移動指定個數字串，可以使用 `3w`
想往下移動指定行數，也可使用 `5j`

## 搜尋與取代

| 按鍵                                            | 功能                                                                              |
| ----------------------------------------------- | --------------------------------------------------------------------------------- |
| `/[字串]`                                       | 向後搜尋 `字串`                                                                   |
| `/\c[字串]`                                     | 向後搜尋 `字串`，不分大小寫                                                       |
| `*`                                             | 將錨點移到 `字串` 上，直接按 `*` 也可以做向下搜尋                                 |
| `?[字串]`                                       | 向前搜尋 `字串`                                                                   |
| `?\c[字串]`                                     | 向前搜尋 `字串`，不分大小寫                                                       |
| `:set ic`                                       | 搜尋時不分大小寫                                                                  |
| `:set noic`                                     | 搜尋時分辨大小寫                                                                  |
| `n`                                             | 繼續下一個搜尋結果                                                                |
| `N`                                             | 繼續上一個搜尋結果                                                                |
| `:[起始行],[終止行]s/[搜尋字串]/[取代字串]/gic` | 取代第 `n` 行到第 `n` 行中的 `字串`<br> (`g`: 整行全部 `i`: 不分大小寫 `c`: 詢問) |
| `:1,$s/[搜尋字串]/[取代字串]/gic`               | 取代全部字串<br> (`g`: 整行全部 `i`: 不分大小寫 `c`: 詢問)                        |
| `:noh`                                          | 結束搜尋                                                                          |
| `c[movement]`                                   | 取代操作子，移除對應範圍內容並進入編輯模式                                        |
| `ci[text_object]`                               | 刪除 `[text_object]` 裡的內容並進入編輯模式                                       |
| `ca[text_object]`                               | 刪除含 `[text_object]` 的內容並進入編輯模式                                       |

`c` 例：

```
▼
Hello Aimaime!
> cwGood morning,<C-[>
Good morning, Aimaime!
```

### `[text_object]`

| Text Object | 意義              |
| ----------- | ----------------- |
| w           | 字串              |
| W           | 以空白分隔的區塊  |
| p           | 段落              |
| `"`         | `""` 範圍中的內容 |
| `'`         | `''` 範圍中的內容 |
| `)`         | `()` 範圍中的內容 |
| `]`         | `[]` 範圍中的內容 |
| `}`         | `{}` 範圍中的內容 |

`ci` 例：

```
▼
Hello "Vim"!
> ci"VIM<C-[>
Hello "VIM"!
```

## 標記與複製

| 按鍵              | 功能                                                 |
| ----------------- | ---------------------------------------------------- |
| `v`               | 開始字串標記                                         |
| `v -> Ctrl + V`   | 開始區塊標記                                         |
| `V`               | 開始行標記                                           |
| `d`               | 刪除標記的內容                                       |
| `y`               | 複製標記的內容                                       |
| `yy`              | 複製錨點行                                           |
| `yyp`             | 複製貼上                                             |
| `yG`              | 複製錨點行到最後一行                                 |
| `y1G`             | 複製錨點行到第一行                                   |
| `y$`              | 複製錨點處至最後一個字元為止的內容                   |
| `y0`              | 複製錨點處到第一個字元為止的內容                     |
| `p`               | 在下一行貼上複製或刪除的內容                         |
| `P`               | 在上一行貼上複製或刪除的內容                         |
| `Ctrl + R -> 0`   | 在下一行貼上複製或刪除的內容，適用於編輯模式及指令行 |
| `yi[text_object]` | 複製 `[text_object]` 裡的內容                        |
| `ya[text_object]` | 複製含 `[text_object]` 的內容                        |

### 刪除

| 按鍵              | 功能                           |
| ----------------- | ------------------------------ |
| `dd`              | 刪除錨點所在行                 |
| `[數字] + dd`     | 刪除 `[數字]` 行               |
| `ddp`             | 剪下貼上                       |
| `dG`              | 刪除錨點行起到最後一行的內容   |
| `d1G`             | 刪除錨點行起到第一行的內容     |
| `d$`              | 刪除錨點處到最後一個字元的內容 |
| `d0`              | 刪除錨點處到第一個字元的內容   |
| `di[text_object]` | 刪除 `[text_object]` 裡的內容  |
| `da[text_object]` | 刪除含 `[text_object]` 的內容  |

## 其它指令

| 按鍵             | 功能                                                        |
| ---------------- | ----------------------------------------------------------- |
| `J`              | 將錨點行與下一行合併                                        |
| `u`              | 還原（Undo）操作                                            |
| `Ctrl + r`       | 重做（Redo）操作                                            |
| `Ctrl + N`       | 自動補齊曾輸入過的單字                                      |
| `.`              | 重覆上一個指令                                              |
| `q[trigger_key]` | 記錄行為巨集                                                |
| `@[trigger_key]` | 執行行為巨集                                                |
| `! 命令`         | 執行 linux 指令，並顯示執行結果                             |
| `TOhtml`         | 將目前編輯的檔案轉換成 HTML 原始碼 (會新增一個水平分割視窗) |

### 巨集

- 錄製途中結束或中斷同樣使用 `q` 即可
- `@` 亦可加上數字多次執行

## 檔案瀏覽器操作

- 需先以 `:Ex` 或關聯指令進入檔案瀏覽器

| 按鍵 | 功能               |
| ---- | ------------------ |
| `-`  | 移動到上層目錄     |
| `d`  | 建立目錄           |
| `D`  | 刪除目錄           |
| `R`  | 重新命名           |
| `s`  | 切換排序方式       |
| `r`  | 切換升冪/降冪排序  |
| `i`  | 切換檔案的排列方式 |
| `/`  | 搜尋字串           |
| `x`  | 執行檔案           |
| `o`  | 新增水平視窗       |
| `v`  | 新增垂直視窗       |

## 組合運用

1. 刪除搜尋文字

- `/example`
  - `/`：搜尋關鍵字
- `gnd`
  - `gn`：前往下一個搜尋的關鍵字（`n`）
  - `d`：刪除選擇內容

2. 同時輸入多行內容

- [Vim: insert the same characters across multiple lines](https://stackoverflow.com/questions/9549729/vim-insert-the-same-characters-across-multiple-lines)
- 使用 `v` 選擇範圍
- 使用 `I` 切換模式（大寫）

3. 選擇所有內容

- [How To "Select All" In Vim/Vi?](https://linuxtect.com/how-to-select-all-in-vim-vi/)
- `ggVG`：選擇
- `ggy$`：複製
- `:%y`：複製
- `:%d`：刪除

4. 選擇／刪除方塊狀區域

- 使用 `Ctrl + v` 選擇範圍

## 參考資料

- [Vim Cheat Sheet](https://vim.rtorr.com/lang/zh_tw)
- [給程式設計師的 Vim 入門圖解說明 | vgod's blog](https://blog.vgod.tw/2009/12/08/vim-cheat-sheet-for-programmers/)
- [📒1 時間で Vim に惚れるチュートリアル - Minerva](https://minerva.mamansoft.net/%F0%9F%93%971%E6%99%82%E9%96%93%E3%81%A7Vim%E3%81%AB%E6%83%9A%E3%82%8C%E3%82%8B%E3%83%81%E3%83%A5%E3%83%BC%E3%83%88%E3%83%AA%E3%82%A2%E3%83%AB/%F0%9F%93%921%E6%99%82%E9%96%93%E3%81%A7Vim%E3%81%AB%E6%83%9A%E3%82%8C%E3%82%8B%E3%83%81%E3%83%A5%E3%83%BC%E3%83%88%E3%83%AA%E3%82%A2%E3%83%AB)
- [Vim をメモ帳程度に使うために覚えておくべきコマンド](https://qiita.com/honeniq/items/201156650310c4968c3a)
- [アニメーションで学ぶ Vim 入門 ～精選 10 機能～](https://qiita.com/KoyanagiHitoshi/items/82ef910432552d0a4553)
- [ぼくの Vim さばきを支える設定とその導入手順を紹介する](https://qiita.com/jiroshin/items/ee86ea426a51fa24b319)
- [Vim 幼稚園から Vim 小学校へ](https://qiita.com/hachi8833/items/7beeee825c11f7437f54)
- [脱初心者を目指すなら知っておきたい便利な Vim コマンド 25 選 (Vimmer レベル診断付き)](https://qiita.com/jnchito/items/57ffda5712636a9a1e62)
- [man vifm (1): vi file manager](https://manpages.org/vifm)
- [Vifm - Cheatsheet](https://vifm.info/cheatsheets.shtml)
